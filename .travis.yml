language: clojure
fail_fast: true
services:
  - docker
cache:
  directories:
    - ~/.m2
jdk:
  - oraclejdk8
env:
  - DOCKER=stable
  - DOCKER=edge
  - DOCKER=rc
  - DOCKER=1.13.0
  - DOCKER=1.12.0
install:
  - bash dev/script/start-dind.sh
script:
  - lein test :all
  - lein with-profile prod uberjar
  - docker build -t swarmpit .
  - bash dev/script/deploy-image.sh